# 多阶段构建 - 生产环境\nFROM python:3.11-slim as base\n\n# 设置环境变量\nENV PYTHONUNBUFFERED=1 \\\n    PYTHONDONTWRITEBYTECODE=1 \\\n    PIP_NO_CACHE_DIR=1 \\\n    PIP_DISABLE_PIP_VERSION_CHECK=1\n\n# 安装系统依赖\nRUN apt-get update && apt-get install -y \\\n    gcc \\\n    g++ \\\n    libpq-dev \\\n    libffi-dev \\\n    libssl-dev \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*\n\n# 创建应用用户\nRUN groupadd -r appuser && useradd -r -g appuser appuser\n\n# 设置工作目录\nWORKDIR /app\n\n# 复制依赖文件\nCOPY requirements.txt .\n\n# 安装Python依赖\nRUN pip install --no-cache-dir -r requirements.txt\n\n# 复制应用代码\nCOPY . .\n\n# 创建必要的目录\nRUN mkdir -p logs data/cache && \\\n    chown -R appuser:appuser /app\n\n# 切换到应用用户\nUSER appuser\n\n# 健康检查\nHEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \\\n    CMD curl -f http://localhost:8000/health || exit 1\n\n# 暴露端口\nEXPOSE 8000\n\n# 启动命令\nCMD [\"uvicorn\", \"quant_framework.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\", \"--workers\", \"4\"]\n