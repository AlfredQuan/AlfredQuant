# 多阶段构建 - 前端生产环境\nFROM node:18-alpine as builder\n\n# 设置工作目录\nWORKDIR /app\n\n# 复制package文件\nCOPY package*.json ./\n\n# 安装依赖\nRUN npm ci --only=production\n\n# 复制源代码\nCOPY . .\n\n# 构建应用\nRUN npm run build\n\n# 生产阶段\nFROM nginx:alpine\n\n# 复制构建产物\nCOPY --from=builder /app/build /usr/share/nginx/html\n\n# 复制nginx配置\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n# 创建nginx用户\nRUN addgroup -g 1001 -S nginx && \\\n    adduser -S -D -H -u 1001 -h /var/cache/nginx -s /sbin/nologin -G nginx -g nginx nginx\n\n# 健康检查\nHEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \\\n    CMD curl -f http://localhost:80/health || exit 1\n\n# 暴露端口\nEXPOSE 80\n\n# 启动nginx\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n